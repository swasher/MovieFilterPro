{% extends "base.html" %}

{% block body %}

    <div class="container-fluid vh-100 d-flex flex-column">

        <!-- SEARCH BAR -->
        <div class="bg-body-tertiary border-bottom p-3 flex-shrink-0">
            <div class="container-fluid">
                <div class="row justify-content-center">
                    <div class="col-12 col-md-7 col-lg-5"> <!-- Здесь ограничиваем ширину -->

                        <!-- ВАЖНО: позиционный контейнер -->
                        <div class="position-relative">

                        <input class="form-control" type="search"
                               name="query" placeholder="Поиск фильма..."
                               hx-post="{% url 'vault:search_movies' %}"
                               hx-trigger="input changed delay:1000ms, keyup[key=='Enter']"
                               hx-target="#search-results"
                               {% comment %}hx-indicator=".htmx-indicator"{% endcomment %}
                               autocomplete="off">


                        <!-- Контейнер для результатов -->
                        <div
                                id="search-results"
                                class="list-group position-absolute w-100 mt-2 shadow rounded d-none"
                                style="z-index: 2000; max-height: 350px; overflow-y: auto;"
                        >
                        <div class="htmx-indicator spinner-border spinner-border-sm text-secondary ms-2" role="status"></div>

                            <!-- Здесь HTMX будет подставлять результаты -->
                        </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MAIN LAYOUT -->
        <div class="d-flex flex-grow-1 overflow-hidden">

            <!-- SIDEBAR -->
            <aside class="bg-body-tertiary border-end p-3"
                   style="width: 280px; min-width: 240px;">

                <div class="list-group list-group-flush gap-2">

                    {% for spisok in movie_lists.results %}
                        <button class="list-group-item list-group-item-action bg-body-secondary border-1 rounded-2 fw-semibold text-body-secondary">
                            {{ spisok.name }}
                        </button>
                    {% endfor %}

                </div>
            </aside>


            <!-- CONTENT AREA -->
            <main class="flex-grow-1 p-3 overflow-auto" id="main-content">

                <!-- GRID WRAPPER -->
                <div class="d-grid gap-3"
                     style="grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));">

                    <!-- MOVIE CARD PLACEHOLDERS -->
                    <div class="bg-secondary bg-opacity-10 rounded" style="height: 240px;"></div>
                    <div class="bg-secondary bg-opacity-10 rounded" style="height: 240px;"></div>
                    <div class="bg-secondary bg-opacity-10 rounded" style="height: 240px;"></div>
                    <div class="bg-secondary bg-opacity-10 rounded" style="height: 240px;"></div>
                    <div class="bg-secondary bg-opacity-10 rounded" style="height: 240px;"></div>
                    <div class="bg-secondary bg-opacity-10 rounded" style="height: 240px;"></div>

                </div>

            </main>

        </div>
    </div>


    <script>
        // Очистка выпадающего списка фильмов (в поиске) после клика
        document.addEventListener("htmx:afterSwap", () => {
            const box = document.getElementById("search-results");
            if (box.innerHTML.trim() === "") {
                box.classList.add("d-none");
            } else {
                box.classList.remove("d-none");
            }
        });

        // Закрытие при клике вне списка
        document.addEventListener("click", (evt) => {
            const box = document.getElementById("search-results");
            if (!box) return;
            if (!box.contains(evt.target) && !evt.target.matches('input[name="query"]')) {
                box.classList.add("d-none");
            }
        });
    </script>

{% comment %}    <script>

        {# Очистка выпадающего списка фильмов (в поиске) после клика  #}
        document.addEventListener("htmx:afterSwap", (evt) => {
            const box = document.getElementById("search-results");
            if (box && box.innerHTML.trim() !== "") {
                box.classList.remove("d-none");
            } else {
                box.classList.add("d-none");
            }
        });

        // Закрытие при клике вне списка
        document.addEventListener("click", (evt) => {
            const box = document.getElementById("search-results");
            if (!box) return;
            if (!box.contains(evt.target) && !evt.target.matches('input[name="query"]')) {
                box.classList.add("d-none");
            }
        });
    </script>{% endcomment %}

{% endblock %}
