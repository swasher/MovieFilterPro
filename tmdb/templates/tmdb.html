{% extends "base.html" %}

{% block body %}

    <div class="container-fluid d-flex flex-column">

        <!-- SEARCH BAR -->
        <div class="bg-body-tertiary border-bottom p-3 flex-shrink-0">
            <div class="container-fluid">
                <div class="row justify-content-center">
                    <div class="col-12 col-md-7 col-lg-5"> <!-- Здесь ограничиваем ширину -->

                        <form hx-post="{% url 'tmdb:search_movies_fullpage' %}"
                              hx-target="#main-content"
                              hx-push-url="false"
                              class="d-flex w-100">

                            <div class="dropdown position-relative w-100">

                                <input type="search"
                                       id="movie-search-input"
                                       class="form-control"
                                       name="query"
                                       placeholder="Поиск фильма..."
                                       hx-post="{% url 'tmdb:search_movies_dropdown' %}"
                                       hx-trigger="input changed delay:500ms"
                                       hx-target="#search-results"
                                       hx-push-url="false"
                                       autocomplete="off"
                                       aria-expanded="false">

                                <ul class="dropdown-menu w-100"
                                    id="search-results"
                                    style="max-height: 300px; overflow-y: auto;">
                                </ul>
                            </div>
                        </form>

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                const searchInput = document.getElementById('movie-search-input');
                                const searchResults = document.getElementById('search-results');
                                const mainContent = document.getElementById('main-content');
                                const searchForm = searchInput.closest('form');

                                // Показываем меню при приходе данных
                                searchResults.addEventListener('htmx:afterSwap', function() {
                                    if (searchResults.children.length > 0) {
                                        searchResults.classList.add('show');
                                    }
                                });

                                //  Очищаем input после fullpage-поиска (Enter)
                                mainContent.addEventListener('htmx:afterSwap', function () {
                                    searchInput.value = '';
                                    searchResults.classList.remove('show');
                                });

                                // Клик вне input и dropdown — скрываем dropdown и очищаем строку поиска
                                document.addEventListener('click', function (e) {
                                    if (
                                        !searchInput.contains(e.target) &&
                                        !searchResults.contains(e.target)
                                    ) {
                                        searchResults.classList.remove('show');
                                        searchInput.value = '';
                                    }
                                });
                            });
                        </script>
                    </div>
                </div>
            </div>
        </div>

        <!-- MAIN LAYOUT -->
        <div class="d-flex flex-grow-1 overflow-hidden">

            <!-- SIDEBAR -->
            <aside class="bg-body-tertiary border-end p-3"
                   style="width: 280px; min-width: 240px;">

                <div class="list-group list-group-flush gap-2">

                    {% for spisok in movie_lists.results %}
                        <a class="list-group-item list-group-item-action bg-body-secondary border-1 rounded-2 fw-semibold text-body-secondary"
                           hx-post="{% url 'tmdb:list_get_movies' spisok.id %}"
                           hx-trigger="click"
                           hx-target="#main-content"
                           role="button"
                        >
                            {{ spisok.name }} <small><i class="bi bi-trash3-fill"></i></small>
                        </a>
                    {% endfor %}

                </div>
            </aside>


            <!-- CONTENT AREA -->
            <main class="flex-grow-1 p-3 overflow-auto" id="main-content">

                <!-- GRID WRAPPER -->
                <div class="d-grid gap-3"
                     style="grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));">

                    <!-- MOVIE CARD PLACEHOLDERS -->
                    <div class="bg-secondary bg-opacity-10 rounded" style="height: 240px;"></div>
                    <div class="bg-secondary bg-opacity-10 rounded" style="height: 240px;"></div>
                    <div class="bg-secondary bg-opacity-10 rounded" style="height: 240px;"></div>
                    <div class="bg-secondary bg-opacity-10 rounded" style="height: 240px;"></div>
                    <div class="bg-secondary bg-opacity-10 rounded" style="height: 240px;"></div>
                    <div class="bg-secondary bg-opacity-10 rounded" style="height: 240px;"></div>


                </div>

            </main>

        </div>
    </div>

<style>
    #main-content {
        height: auto;
        overflow: visible;
    }
</style>


{% endblock %}
